<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:site_name" content="æœˆç™½ Yuebaix Blog">
<meta property="og:type" content="article">
<meta property="og:image" content="https://blog.yuebaix.com/img/home-bg-jeep.jpg">
<meta property="twitter:image" content="https://blog.yuebaix.com/img/home-bg-jeep.jpg">
<meta name=title content="ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤">
<meta property="og:title" content="ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤">
<meta property="twitter:title" content="ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤">
<meta name=description content="æœåŠ¡è°ƒç”¨ã€æ–‡æ¡£é›†ä¸­">
<meta property="og:description" content="æœåŠ¡è°ƒç”¨ã€æ–‡æ¡£é›†ä¸­">
<meta property="twitter:description" content="æœåŠ¡è°ƒç”¨ã€æ–‡æ¡£é›†ä¸­">
<meta property="twitter:card" content="summary">
<meta name=keyword content="æœˆç™½, yuebaix, Yuebaix, , æœˆç™½çš„åšå®¢, Yuebaix Blog, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Web, Spring, Springboot, Spring Cloud, Webflux, äº‘åŸç”Ÿ, PaaS, Istio, Kubernetes, å¾®æœåŠ¡, Microservice">
<link rel="shortcut icon" href=/img/favicon.ico>
<title>ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤-æœˆç™½çš„åšå®¢ | Yuebaix Blog</title>
<link rel=canonical href=/2021/10/04/%E4%B8%83%E5%A4%A9%E6%9E%84%E5%BB%BAspringcloud%E9%9B%86%E7%BE%A4/>
<link rel=stylesheet href=/css/iDisqus.min.css>
<link rel=stylesheet href=/css/bootstrap.min.css>
<link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css>
<link rel=stylesheet href=/css/zanshang.css>
<link href=//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css rel=stylesheet type=text/css>
<script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script>
</head>
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
<div class=container-fluid>
<div class="navbar-header page-scroll">
<button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=/>æœˆç™½ Yuebaix Blog</a>
</div>
<div id=huxblog_navbar>
<div class=navbar-collapse>
<ul class="nav navbar-nav navbar-right">
<li>
<a href=/>Home</a>
</li>
<li>
<a href=/categories/life>life</a>
</li>
<li>
<a href=/categories/tech>tech</a>
</li>
<li><a href=/top/archive/>ARCHIVE</a></li>
<li><a href=/top/links/>LINKS</a></li>
<li><a href=/top/about/>ABOUT</a></li>
</ul>
</div>
</div>
</div>
</nav>
<script>var $body=document.body,$toggle=document.querySelector('.navbar-toggle'),$navbar=document.querySelector('#huxblog_navbar'),$collapse=document.querySelector('.navbar-collapse');$toggle.addEventListener('click',handleMagic);function handleMagic(a){$navbar.className.indexOf('in')>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf('in')<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script>
<style type=text/css>header.intro-header{background-image:url(/img/home-bg-jeep.jpg)}</style>
<header class=intro-header>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=post-heading>
<div class=tags>
<a class=tag href=/tags/%E5%B9%B2%E8%B4%A7 title=å¹²è´§>
å¹²è´§
</a>
<a class=tag href=/tags/%E6%95%99%E7%A8%8B title=æ•™ç¨‹>
æ•™ç¨‹
</a>
</div>
<h1>ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤</h1>
<h2 class=subheading>day4ï¼šé›†ç¾¤é€šä¿¡</h2>
<span class=meta>
Posted by
æœˆç™½
on
Monday, October 4, 2021
</span>
</div>
</div>
</div>
</div>
</header>
<article>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container">
<p>é¡¹ç›®åœ°å€ï¼š<a href=https://github.com/yuebaix/jiuzhou>jiuzhou (ä¹å·) https://github.com/yuebaix/jiuzhou</a></p>
<a style=display:inline-block;width:400px;height:170px target=_blank href=https://github.com/yuebaix/jiuzhou>
<img align=left src="https://github-readme-stats.vercel.app/api/pin/?username=yuebaix&theme=highcontrast&repo=jiuzhou">
</a>
<h2 id=ä¸€æœåŠ¡è°ƒç”¨>ä¸€ã€æœåŠ¡è°ƒç”¨</h2>
<h3 id=1åœ¨bizfacadeä¸­å¼€å‘feignclient>1.åœ¨bizfacadeä¸­å¼€å‘feignClient</h3>
<p>bizfacadeæ·»åŠ gradleä¾èµ–</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>implementation <span style=color:#f1fa8c>&#39;org.springframework.cloud:spring-cloud-starter-openfeign&#39;</span>
</code></pre></div><p>åˆ›å»ºfeignClient</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>interface</span> <span style=color:#50fa7b>BizFacadeConst</span> <span style=color:#ff79c6>{</span>
    String SVC_UAA <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;svc-uaa&#34;</span><span style=color:#ff79c6>;</span>
    String APP_BIZ <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;app-biz&#34;</span><span style=color:#ff79c6>;</span>
    String APP_BIZAGG <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;app-bizagg&#34;</span><span style=color:#ff79c6>;</span>
<span style=color:#ff79c6>}</span>

@FeignClient<span style=color:#ff79c6>(</span>name <span style=color:#ff79c6>=</span> BizFacadeConst<span style=color:#ff79c6>.</span><span style=color:#50fa7b>APP_BIZ</span><span style=color:#ff79c6>,</span> fallbackFactory <span style=color:#ff79c6>=</span> BizFeignClientFallbackFactory<span style=color:#ff79c6>.</span><span style=color:#50fa7b>class</span><span style=color:#ff79c6>)</span>
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>interface</span> <span style=color:#50fa7b>BizFeignClient</span> <span style=color:#ff79c6>{</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/demo/appName&#34;</span><span style=color:#ff79c6>)</span>
    String <span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
<span style=color:#ff79c6>}</span>

@Slf4j
@Component
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>BizFeignClientFallbackFactory</span> <span style=color:#8be9fd;font-style:italic>implements</span> FallbackFactory<span style=color:#ff79c6>&lt;</span>BizFeignClient<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>{</span>
    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> BizFeignClient <span style=color:#50fa7b>create</span><span style=color:#ff79c6>(</span>Throwable cause<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>new</span> BizFeignClient<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
            @Override
            <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>appName</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
                log<span style=color:#ff79c6>.</span><span style=color:#50fa7b>error</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;feign error&#34;</span><span style=color:#ff79c6>,</span> cause<span style=color:#ff79c6>);</span>
                <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;biz-fallback&#34;</span><span style=color:#ff79c6>;</span>
            <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>};</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><h3 id=2åœ¨bizaggä¸­å¼•å…¥bizfacadeå®ç°åº”ç”¨è°ƒç”¨>2.åœ¨bizaggä¸­å¼•å…¥bizfacadeå®ç°åº”ç”¨è°ƒç”¨</h3>
<p>bizaggæ·»åŠ gradleä¾èµ–</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>implementation <span style=color:#f1fa8c>&#39;org.springframework.cloud:spring-cloud-starter-openfeign&#39;</span>
implementation <span style=color:#50fa7b>project</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;:app:jiuzhou-bizfacade&#39;</span><span style=color:#ff79c6>)</span>
</code></pre></div><p>application.propertiesæ·»åŠ é…ç½®</p>
<pre tabindex=0><code class=language-properties data-lang=properties>feign.client.config.default.logger-level = full
feign.circuitbreaker.enabled=true
</code></pre><p>å¯åŠ¨ç±»å¢åŠ feignå¼€å¯æ³¨è§£@EnableFeignClientsä»¥åŠä¿®æ­£åŒ…æ‰«æé…ç½®ï¼Œæ­¤å¤„éœ€è¦æ‰«æåˆ°bizfacadeä¸­çš„fallbackFactoryçš„Component</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>@EnableFeignClients<span style=color:#ff79c6>(</span>basePackages <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;com.yuebaix.jiuzhou.app.bizfacade&#34;</span><span style=color:#ff79c6>)</span>
@EnableDiscoveryClient
@SpringBootApplication<span style=color:#ff79c6>(</span>scanBasePackages <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;com.yuebaix.jiuzhou&#34;</span><span style=color:#ff79c6>)</span>
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>BizAggApp</span> <span style=color:#ff79c6>{</span>
    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>main</span><span style=color:#ff79c6>(</span>String<span style=color:#ff79c6>[]</span> args<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        SpringApplication<span style=color:#ff79c6>.</span><span style=color:#50fa7b>run</span><span style=color:#ff79c6>(</span>BizAggApp<span style=color:#ff79c6>.</span><span style=color:#50fa7b>class</span><span style=color:#ff79c6>,</span> args<span style=color:#ff79c6>);</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><p>æ·»åŠ æµ‹è¯•æ¥å£</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>@Api<span style=color:#ff79c6>(</span>tags <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;ç¤ºä¾‹æ¥å£&#34;</span><span style=color:#ff79c6>)</span>
@Slf4j
@RestController
@RequestMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/demo&#34;</span><span style=color:#ff79c6>)</span>
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>DemoController</span> <span style=color:#ff79c6>{</span>
    @Value<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;${spring.application.name}&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>private</span> String appName<span style=color:#ff79c6>;</span>
    @Autowired
    <span style=color:#8be9fd;font-style:italic>private</span> UaaFeignClient uaaFeignClient<span style=color:#ff79c6>;</span>
    @Autowired
    <span style=color:#8be9fd;font-style:italic>private</span> BizFeignClient bizFeignClient<span style=color:#ff79c6>;</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;æœåŠ¡åç§°&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/appName&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>appName</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> appName<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;è°ƒç”¨svc-uaa&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/callSvcUaa&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>callSvcUaa</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> uaaFeignClient<span style=color:#ff79c6>.</span><span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
    <span style=color:#ff79c6>}</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;è°ƒç”¨app-biz&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/callAppBiz&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>callAppBiz</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> bizFeignClient<span style=color:#ff79c6>.</span><span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><p>è¿›è¡Œè°ƒç”¨æµ‹è¯•</p>
<p>
<img src=/pic/2021_10_04/call_fallback.png alt>
</p>
<p>
<img src=/pic/2021_10_04/call_fallback_error.png alt>
</p>
<p>
<img src=/pic/2021_10_04/call_success.png alt>
</p>
<h3 id=3åœ¨bizä¸bizclientä¸­å¼•å…¥feignå®ç°>3.åœ¨bizä¸bizclientä¸­å¼•å…¥feignå®ç°</h3>
<p>ç”±äºè°ƒç”¨å±‚çº§å…³ç³»ï¼Œcontrolleræœ‰æ‰€ä¸åŒ</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#6272a4>//bizä¸­
</span><span style=color:#6272a4></span>@Api<span style=color:#ff79c6>(</span>tags <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;ç¤ºä¾‹æ¥å£&#34;</span><span style=color:#ff79c6>)</span>
@Slf4j
@RestController
@RequestMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/demo&#34;</span><span style=color:#ff79c6>)</span>
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>DemoController</span> <span style=color:#ff79c6>{</span>
    @Value<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;${spring.application.name}&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>private</span> String appName<span style=color:#ff79c6>;</span>
    @Autowired
    <span style=color:#8be9fd;font-style:italic>private</span> UaaFeignClient uaaFeignClient<span style=color:#ff79c6>;</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;æœåŠ¡åç§°&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/appName&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>appName</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> appName<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;è°ƒç”¨svc-uaa&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/callSvcUaa&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>callSvcUaa</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> uaaFeignClient<span style=color:#ff79c6>.</span><span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#6272a4>//bizclientä¸­
</span><span style=color:#6272a4></span>@Api<span style=color:#ff79c6>(</span>tags <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;ç¤ºä¾‹æ¥å£&#34;</span><span style=color:#ff79c6>)</span>
@Slf4j
@RestController
@RequestMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/demo&#34;</span><span style=color:#ff79c6>)</span>
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>DemoController</span> <span style=color:#ff79c6>{</span>
    @Value<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;${spring.application.name:app-bizclient}&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>private</span> String appName<span style=color:#ff79c6>;</span>
    @Autowired
    <span style=color:#8be9fd;font-style:italic>private</span> UaaFeignClient uaaFeignClient<span style=color:#ff79c6>;</span>
    @Autowired
    <span style=color:#8be9fd;font-style:italic>private</span> BizFeignClient bizFeignClient<span style=color:#ff79c6>;</span>
    @Autowired
    <span style=color:#8be9fd;font-style:italic>private</span> BizAggFeignClient bizAggFeignClient<span style=color:#ff79c6>;</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;æœåŠ¡åç§°&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/appName&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>appName</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> appName<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;è°ƒç”¨svc-uaa&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/callSvcUaa&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>callSvcUaa</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> uaaFeignClient<span style=color:#ff79c6>.</span><span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
    <span style=color:#ff79c6>}</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;è°ƒç”¨app-biz&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/callAppBiz&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>callAppBiz</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> bizFeignClient<span style=color:#ff79c6>.</span><span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
    <span style=color:#ff79c6>}</span>

    @ApiOperation<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;è°ƒç”¨app-bizagg&#34;</span><span style=color:#ff79c6>)</span>
    @GetMapping<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;/callAppBizagg&#34;</span><span style=color:#ff79c6>)</span>
    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>callAppBizagg</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> bizAggFeignClient<span style=color:#ff79c6>.</span><span style=color:#50fa7b>appName</span><span style=color:#ff79c6>();</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><h2 id=äºŒæ–‡æ¡£é›†ä¸­>äºŒã€æ–‡æ¡£é›†ä¸­</h2>
<h3 id=1å®Œæˆsys-gateå¯¹æœåŠ¡çš„è·¯ç”±>1.å®Œæˆsys-gateå¯¹æœåŠ¡çš„è·¯ç”±</h3>
<p>æ‰“å¼€gateé…ç½®æ–‡ä»¶application.propertiesè°ƒè¯•é…ç½®æ–¹ä¾¿æŸ¥çœ‹è½¬å‘æƒ…å†µ</p>
<pre tabindex=0><code class=language-properties data-lang=properties>logging.level.org.springframework.cloud.gateway=trace
spring.cloud.gateway.httpclient.wiretap=true
spring.cloud.gateway.httpserver.wiretap=true
</code></pre><p>propertiesé…ç½®è·¯ç”±æ¯”è¾ƒsufferï¼Œå¹²è„†å†åŠ ä¸ªapplication.ymlæ¥é…ç½®è·¯ç”±åœ°å€</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>spring</span>:
  <span style=color:#ff79c6>cloud</span>:
    <span style=color:#ff79c6>gateway</span>:
      <span style=color:#ff79c6>routes</span>:
        - <span style=color:#ff79c6>id</span>: route-app-bizagg
          <span style=color:#ff79c6>uri</span>: lb://app-bizagg
          <span style=color:#ff79c6>predicates</span>:
            - Path=/app-bizagg/**
          <span style=color:#ff79c6>filters</span>:
            - StripPrefix=1
        - <span style=color:#ff79c6>id</span>: route-app-biz
          <span style=color:#ff79c6>uri</span>: lb://app-biz
          <span style=color:#ff79c6>predicates</span>:
            - Path=/app-biz/**
          <span style=color:#ff79c6>filters</span>:
            - StripPrefix=1
</code></pre></div><p>å†æä¾›ä¸€ä¸‹application.propertiesè·¯ç”±çš„é…ç½®ç¤ºä¾‹</p>
<pre tabindex=0><code class=language-properties data-lang=properties>spring.cloud.gateway.routes[0].id=app-bizagg-route
spring.cloud.gateway.routes[0].uri=lb://app-bizagg
spring.cloud.gateway.routes[0].predicates[0]=Path=/app-bizagg/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=1
</code></pre><p>è¿™ä¸ªæ—¶å€™gateå¯¹å„ä¸ªæœåŠ¡çš„è¯·æ±‚å°±æ‰“é€šäº†ï¼Œä½†æ˜¯è¿”å›çš„æ–‡æ¡£å†…å®¹æ²¡æœ‰å‰ç¼€ï¼Œæ— æ³•è®¿é—®åˆ°æœåŠ¡ä¸Šï¼Œå¦‚æœè·¯ç”±å‰ç¼€è·ŸæœåŠ¡contextPathä¸€è‡´çš„è¯åº”è¯¥å·²ç»é€šäº†ï¼Œä½†æ˜¯è¿™é‡Œ
æ²¡æœ‰è®¾ç½®contextPathï¼Œæ¯”è¾ƒå—é™ï¼Œä¸€ä¼šæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id=2å®Œæˆswaggeræ¥å£çš„è·¯ç”±é…ç½®>2.å®Œæˆswaggeræ¥å£çš„è·¯ç”±é…ç½®</h3>
<p>å…ˆæ¥è§£å†³æ–‡æ¡£/v3/api-docsè¿”å›çš„jsonä¸­serveråœ°å€æ— å‰ç¼€çš„é—®é¢˜</p>
<blockquote>
<p>åœ¨çº¿æ–‡æ¡£æ¥å£å‰ç¼€å¯ä»¥è‡ªåŠ¨æ ¹æ®è¯·æ±‚åœ°å€æ¥è‡ªåŠ¨é€‚é…ï¼ŒåŸç†æ˜¯ç½‘å…³ä¼šå°†è¯·æ±‚å¤´<em>X-Forwarded-Prefix</em>è¿›è¡Œå åŠ è½¬å‘ï¼Œspringfoxæ–‡æ¡£ä¼šè‡ªåŠ¨æ ¹æ®è¿™ä¸ªheaderæ¥
è¿›è¡Œé€‚é…ã€‚æ­¤æ¬¡å¼€å‘ä¸­ï¼Œå‘ç°æœ‰ä¸¤ä¸ªå˜åŒ–ï¼Œä¸€ä¸ªæ˜¯gatewayä¼šè‡ªåŠ¨å°†è¿™ä¸ªheaderåœ¨stripPrefixçš„æ’ä»¶æ—¶è‡ªåŠ¨è½¬å‘ä¸‹æ¥ï¼›ä¸€ä¸ªæ˜¯å‡çº§open apiä»¥åï¼Œspringfox
è‡ªå·±çš„mvcå®ç°çš„controlleræŠŠè¿™ä¸ªåŠŸèƒ½ç§»é™¤æ‰äº†ï¼Œéœ€è¦æ‰©å±•å˜æ›´ä¸Šå»æ‰å¯ä½¿ç”¨ã€‚</p>
</blockquote>
<p>å…ˆè®¾ç½®<em>X-Forwarded-Prefix</em>çš„è½¬å‘ï¼Œå®é™…è¿™ä¸ªåœ°æ–¹é»˜è®¤å°±æ˜¯è¿™æ ·çš„é…ç½®ã€‚</p>
<pre tabindex=0><code class=language-properties data-lang=properties>spring.cloud.gateway.x-forwarded.prefix-enabled=true
spring.cloud.gateway.x-forwarded.prefix-append=true
</code></pre><p>ç”±äºspringfoxåœ¨inferredServerè¿™ä¸ªåœ°æ–¹çš„å¤„ç†æ˜¯ç”¨spring pluginå®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªä¸€æ ·çš„æ’ä»¶åœ¨å®ƒå¤„ç†å‡ºæ¥çš„server urlä¸Šæ·»åŠ å‰ç¼€ã€‚
springfoxæœ¬èº«å®ç°çš„pluginæ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å®ç°ä¸é…ç½®é¡ºåºå°±å¯ä»¥äº†ã€‚ç”±äºå„ä¸ªä¸šåŠ¡å¯èƒ½éƒ½è¦ç”¨ï¼Œæ‰€ä»¥å°±å®ç°åœ¨äº†bizfacadeåŒ…ä¸­ã€‚</p>
<p>åœ¨bizfacadeçš„gradleæ–‡ä»¶ä¸­æ–°å¢ä¾èµ–</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>implementation <span style=color:#f1fa8c>&#39;javax.servlet:javax.servlet-api&#39;</span>
implementation <span style=color:#f1fa8c>&#39;io.springfox:springfox-boot-starter&#39;</span>
</code></pre></div><p>åœ¨bizfacadeä¸­å®ç°æ’ä»¶å¹¶å¯¼å…¥SpringContext</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>@Component
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>WebMvcXForwardedPrefixOpenApiTransformationFilter</span> <span style=color:#8be9fd;font-style:italic>implements</span> WebMvcOpenApiTransformationFilter <span style=color:#ff79c6>{</span>
    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd;font-style:italic>final</span> String X_FORWARDED_PREFIX <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;X-Forwarded-Prefix&#34;</span><span style=color:#ff79c6>;</span>
    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd;font-style:italic>final</span> String COMMA <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;,&#34;</span><span style=color:#ff79c6>;</span>

    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> OpenAPI <span style=color:#50fa7b>transform</span><span style=color:#ff79c6>(</span>OpenApiTransformationContext<span style=color:#ff79c6>&lt;</span>HttpServletRequest<span style=color:#ff79c6>&gt;</span> context<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        OpenAPI openApi <span style=color:#ff79c6>=</span> context<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getSpecification</span><span style=color:#ff79c6>();</span>
        context<span style=color:#ff79c6>.</span><span style=color:#50fa7b>request</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>ifPresent</span><span style=color:#ff79c6>(</span>httpServletRequest <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>{</span>
            String xForwardedPrefix <span style=color:#ff79c6>=</span> httpServletRequest<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getHeader</span><span style=color:#ff79c6>(</span>X_FORWARDED_PREFIX<span style=color:#ff79c6>);</span>
            <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(!</span>StringUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>isEmpty</span><span style=color:#ff79c6>(</span>xForwardedPrefix<span style=color:#ff79c6>))</span> <span style=color:#ff79c6>{</span>
                String<span style=color:#ff79c6>[]</span> prefixArr <span style=color:#ff79c6>=</span> xForwardedPrefix<span style=color:#ff79c6>.</span><span style=color:#50fa7b>split</span><span style=color:#ff79c6>(</span>COMMA<span style=color:#ff79c6>);</span>
                <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>prefixArr<span style=color:#ff79c6>.</span><span style=color:#50fa7b>length</span> <span style=color:#ff79c6>&gt;</span> 0<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
                    String prefix <span style=color:#ff79c6>=</span> fixup<span style=color:#ff79c6>(</span>prefixArr<span style=color:#ff79c6>[</span>0<span style=color:#ff79c6>]);</span>
                    List<span style=color:#ff79c6>&lt;</span>Server<span style=color:#ff79c6>&gt;</span> servers <span style=color:#ff79c6>=</span> openApi<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getServers</span><span style=color:#ff79c6>();</span>
                    <span style=color:#ff79c6>for</span> <span style=color:#ff79c6>(</span>Server server <span style=color:#ff79c6>:</span> servers<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
                        UriComponentsBuilder uriComponentsBuilder <span style=color:#ff79c6>=</span> UriComponentsBuilder<span style=color:#ff79c6>.</span><span style=color:#50fa7b>fromUriString</span><span style=color:#ff79c6>(</span>server<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getUrl</span><span style=color:#ff79c6>());</span>
                        uriComponentsBuilder<span style=color:#ff79c6>.</span><span style=color:#50fa7b>path</span><span style=color:#ff79c6>(</span>prefix<span style=color:#ff79c6>);</span>
                        UriComponents uriComponents <span style=color:#ff79c6>=</span> uriComponentsBuilder<span style=color:#ff79c6>.</span><span style=color:#50fa7b>build</span><span style=color:#ff79c6>();</span>
                        server<span style=color:#ff79c6>.</span><span style=color:#50fa7b>setUrl</span><span style=color:#ff79c6>(</span>uriComponents<span style=color:#ff79c6>.</span><span style=color:#50fa7b>toUriString</span><span style=color:#ff79c6>());</span>
                    <span style=color:#ff79c6>}</span>
                <span style=color:#ff79c6>}</span>
            <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>});</span>
        <span style=color:#ff79c6>return</span> openApi<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>boolean</span> <span style=color:#50fa7b>supports</span><span style=color:#ff79c6>(</span>DocumentationType delimiter<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>return</span> delimiter <span style=color:#ff79c6>==</span> DocumentationType<span style=color:#ff79c6>.</span><span style=color:#50fa7b>OAS_30</span><span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>fixup</span><span style=color:#ff79c6>(</span>String path<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>StringUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>isEmpty</span><span style=color:#ff79c6>(</span>path<span style=color:#ff79c6>)</span>
                <span style=color:#ff79c6>||</span> <span style=color:#f1fa8c>&#34;/&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>equals</span><span style=color:#ff79c6>(</span>path<span style=color:#ff79c6>)</span>
                <span style=color:#ff79c6>||</span> <span style=color:#f1fa8c>&#34;//&#34;</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>equals</span><span style=color:#ff79c6>(</span>path<span style=color:#ff79c6>))</span> <span style=color:#ff79c6>{</span>
            <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;/&#34;</span><span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>return</span> StringUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>trimTrailingCharacter</span><span style=color:#ff79c6>(</span>path<span style=color:#ff79c6>.</span><span style=color:#50fa7b>replace</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;//&#34;</span><span style=color:#ff79c6>,</span> <span style=color:#f1fa8c>&#34;/&#34;</span><span style=color:#ff79c6>),</span> <span style=color:#f1fa8c>&#39;/&#39;</span><span style=color:#ff79c6>);</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><p>å®ç°SwaggerResourcesProviderå®ç°è·¯ç”±è½¬æ¢ä¸ºå¤šdefinitionã€‚ä¸€èˆ¬å®ç°SwaggerResourcesProvideræ¥å£å³å¯ï¼Œè¿™é‡Œæˆ‘æ˜¯ç»§æ‰¿InMemorySwaggerResourcesProvider
æ¥å®ç°çš„ï¼Œå¯ä»¥æŠŠgatewayæœ¬èº«çš„æ¥å£ä¹Ÿæ·»åŠ è¿‘definitionä¸­ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>@Primary
@Configuration
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>GatewayRoutesOasSwaggerResourcesProvider</span> <span style=color:#8be9fd;font-style:italic>extends</span> InMemorySwaggerResourcesProvider <span style=color:#ff79c6>{</span>
    <span style=color:#8be9fd;font-style:italic>protected</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd;font-style:italic>final</span> String API_DOCS_URI <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;/v3/api-docs&#34;</span><span style=color:#ff79c6>;</span>
    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd;font-style:italic>final</span> String SWAGGER_VERSION <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;3.0&#34;</span><span style=color:#ff79c6>;</span>
    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> RouteLocator routeLocator<span style=color:#ff79c6>;</span>
    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>final</span> GatewayProperties gatewayProperties<span style=color:#ff79c6>;</span>

    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#50fa7b>GatewayRoutesOasSwaggerResourcesProvider</span><span style=color:#ff79c6>(</span>
            RouteLocator routeLocator<span style=color:#ff79c6>,</span> GatewayProperties gatewayProperties<span style=color:#ff79c6>,</span>
            Environment environment<span style=color:#ff79c6>,</span> DocumentationCache documentationCache<span style=color:#ff79c6>,</span> DocumentationPluginsManager pluginsManager<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        <span style=color:#8be9fd;font-style:italic>super</span><span style=color:#ff79c6>(</span>environment<span style=color:#ff79c6>,</span> documentationCache<span style=color:#ff79c6>,</span> pluginsManager<span style=color:#ff79c6>);</span>
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>routeLocator</span> <span style=color:#ff79c6>=</span> routeLocator<span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>gatewayProperties</span> <span style=color:#ff79c6>=</span> gatewayProperties<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> List<span style=color:#ff79c6>&lt;</span>SwaggerResource<span style=color:#ff79c6>&gt;</span> <span style=color:#50fa7b>get</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        List<span style=color:#ff79c6>&lt;</span>SwaggerResource<span style=color:#ff79c6>&gt;</span> resources <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ArrayList<span style=color:#ff79c6>&lt;&gt;();</span>
        resources<span style=color:#ff79c6>.</span><span style=color:#50fa7b>addAll</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd;font-style:italic>super</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>());</span>
        List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> routes <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ArrayList<span style=color:#ff79c6>&lt;&gt;();</span>
        routeLocator<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getRoutes</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>subscribe</span><span style=color:#ff79c6>(</span>route <span style=color:#ff79c6>-&gt;</span> routes<span style=color:#ff79c6>.</span><span style=color:#50fa7b>add</span><span style=color:#ff79c6>(</span>route<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getId</span><span style=color:#ff79c6>()));</span>
        gatewayProperties<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getRoutes</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>filter</span><span style=color:#ff79c6>(</span>routeDefinition <span style=color:#ff79c6>-&gt;</span> routes<span style=color:#ff79c6>.</span><span style=color:#50fa7b>contains</span><span style=color:#ff79c6>(</span>routeDefinition<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getId</span><span style=color:#ff79c6>())).</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>route <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>{</span>
            route<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getPredicates</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>stream</span><span style=color:#ff79c6>()</span>
                    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>filter</span><span style=color:#ff79c6>(</span>predicateDefinition <span style=color:#ff79c6>-&gt;</span> <span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;Path&#34;</span><span style=color:#ff79c6>).</span><span style=color:#50fa7b>equalsIgnoreCase</span><span style=color:#ff79c6>(</span>predicateDefinition<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getName</span><span style=color:#ff79c6>()))</span>
                    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>forEach</span><span style=color:#ff79c6>(</span>predicateDefinition <span style=color:#ff79c6>-&gt;</span> resources<span style=color:#ff79c6>.</span><span style=color:#50fa7b>add</span><span style=color:#ff79c6>(</span>swaggerResource<span style=color:#ff79c6>(</span>route<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getId</span><span style=color:#ff79c6>(),</span>
                            predicateDefinition<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getArgs</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>get</span><span style=color:#ff79c6>(</span>NameUtils<span style=color:#ff79c6>.</span><span style=color:#50fa7b>GENERATED_NAME_PREFIX</span> <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;0&#34;</span><span style=color:#ff79c6>)</span>
                                    <span style=color:#ff79c6>.</span><span style=color:#50fa7b>replace</span><span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;**&#34;</span><span style=color:#ff79c6>,</span> API_DOCS_URI<span style=color:#ff79c6>))));</span>
        <span style=color:#ff79c6>});</span>
        <span style=color:#ff79c6>return</span> resources<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    <span style=color:#8be9fd;font-style:italic>private</span> SwaggerResource <span style=color:#50fa7b>swaggerResource</span><span style=color:#ff79c6>(</span>String name<span style=color:#ff79c6>,</span> String location<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        SwaggerResource swaggerResource <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SwaggerResource<span style=color:#ff79c6>();</span>
        swaggerResource<span style=color:#ff79c6>.</span><span style=color:#50fa7b>setName</span><span style=color:#ff79c6>(</span>name<span style=color:#ff79c6>);</span>
        swaggerResource<span style=color:#ff79c6>.</span><span style=color:#50fa7b>setLocation</span><span style=color:#ff79c6>(</span>location<span style=color:#ff79c6>);</span>
        swaggerResource<span style=color:#ff79c6>.</span><span style=color:#50fa7b>setSwaggerVersion</span><span style=color:#ff79c6>(</span>SWAGGER_VERSION<span style=color:#ff79c6>);</span>
        <span style=color:#ff79c6>return</span> swaggerResource<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></div><h3 id=3è¿›è¡Œç»¼åˆæµ‹è¯•>3.è¿›è¡Œç»¼åˆæµ‹è¯•</h3>
<p>ä¸ºæ–¹ä¾¿æµ‹è¯•ï¼Œå¯¹biz-aggé…ç½®application.propertiesè¿›è¡ŒcontextPathçš„è°ƒæ•´ï¼Œå¯ä»¥ä¸biz-appå¯¹ç…§</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy>server<span style=color:#ff79c6>.</span><span style=color:#50fa7b>servlet</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>context</span><span style=color:#ff79c6>-</span>path<span style=color:#ff79c6>=/</span>app<span style=color:#ff79c6>-</span>bizagg
</code></pre></div><p>ä¿®æ”¹ç½‘å…³å¯¹åº”çš„è½¬å‘é…ç½®</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ff79c6>spring</span>:
  <span style=color:#ff79c6>cloud</span>:
    <span style=color:#ff79c6>gateway</span>:
      <span style=color:#ff79c6>routes</span>:
        - <span style=color:#ff79c6>id</span>: route-app-bizagg
          <span style=color:#ff79c6>uri</span>: lb://app-bizagg
          <span style=color:#ff79c6>predicates</span>:
            - Path=/app-bizagg/**
<span style=color:#6272a4>#          filters:</span>
<span style=color:#6272a4>#            - StripPrefix=1</span>
</code></pre></div><p>
<img src=/pic/2021_10_04/gate_knife_doc.png alt>
</p>
<p>
<img src=/pic/2021_10_04/gate_knife_doc_definitions.png alt>
</p>
<h3 id=4æ€»ç»“>4.æ€»ç»“</h3>
<p>åˆ°è¿™é‡Œåœ¨çº¿æ–‡æ¡£èšåˆè¿™ä¸ªåŠŸèƒ½å°±å·²ç»å®Œå–„äº†ã€‚å…¶å®è¿˜å¯ä»¥å®ç°ä¸€ä¸ªGlobalFilterå»æ·»åŠ è‡ªå®šä¹‰headerï¼Œå¹¶åœ¨swaggeræ’ä»¶ä¸­å¯¹è‡ªå®šä¹‰headerè¿›è¡Œè¯†åˆ«è½¬æ¢
inferredServeråœ°å€ï¼Œæ­¤å¤„ä¸»è¦ä¸ºäº†æœ€å°åŒ–ä»£ç é‡å®ŒæˆåŠŸèƒ½ã€‚</p>
<h2 id=ä¸‰å¼€å‘æ—¥å¿—>ä¸‰ã€å¼€å‘æ—¥å¿—</h2>
<ul>
<li>1.apollo-quick-start PR åé¦ˆ</li>
</ul>
<blockquote>
<p>ä»Šæ—¥å®‹è€å¸ˆåˆæœ‰åé¦ˆäº†ï¼Œè¦æŠŠè´¦å·å¯†ç çš„ç¯å¢ƒå˜é‡éƒ½å¸¦ä¸Šï¼Œå¹¶ä¸”å¯†ç è¦è„±æ•æ˜¾ç¤ºã€‚ä¹Ÿè®¸æˆ‘å¼€å‘è‡ªå·±çš„ä»£ç å¤ªå¤šäº†ï¼Œåšä¸œè¥¿æ¯”è¾ƒéšæ„ï¼Œæˆ‘ä¸€åº¦ä¹Ÿä»¥ä¸ºè¿™ä¸ªé¡¹ç›®ä¹Ÿåªæ˜¯ä¸ª
ç”¨æ¥æµ‹è¯•çš„ä¸œè¥¿ã€‚æ¥è§¦ä¸‹æ¥æ„Ÿè§‰å¥½åƒä¸æ˜¯ï¼Œè¦æ›´è®¤çœŸåœ°é¢å¯¹åŠŸèƒ½ä¸äº§å“è®¾è®¡ï¼Œå› ä¸ºè¿™äº›æ˜¯ä¸€å¼€å§‹å°±åº”è¯¥èƒ½æƒ³åˆ°çš„ã€‚åœ¨apolloè¿™æ ·çš„é¡¹ç›®é‡Œï¼Œç”¨æˆ·éå¸¸å¤šï¼Œä¹Ÿæ›´åº”è¯¥
è®¤çœŸæ¥åº”å¯¹é—®é¢˜ã€‚ä¹Ÿç”±äºåœ¨è¿™ä¸ªä¸Šé¢æ”¹æ¥æ”¹å»è°ƒæ¥è°ƒå»çš„ï¼Œå¯¼è‡´è‡ªå·±jiuzhoué¡¹ç›®å¼€å‘è¿›åº¦å˜æ…¢äº†ã€‚å‡†å¤‡æ˜å¤©çˆ†è‚ä¸€ä¸‹ã€‚</p>
</blockquote>
<ul>
<li>2.hugo-theme-cleanwhite åé¦ˆ</li>
</ul>
<blockquote>
<p>ä½œè€…æŠŠ <em>è°åœ¨ä½¿ç”¨</em> ç½®é¡¶åˆ°issueäº†ï¼Œè·‘è¿‡å»ç¬¬ä¸€ä¸ªç™»è®°äº†è‡ªå·± ğŸ˜‰ &lsquo;Glad to be helpful&rsquo;</p>
</blockquote>
<ul>
<li>3.å›½åº†è¿‡å¾—å¥½å¿«</li>
</ul>
<blockquote>
<p>ä¹Ÿè®¸æ˜¯å› ä¸ºè‡ªå·±ä¸€ç›´åœ¨å†™ä»£ç ï¼Œæ„Ÿè§‰è¿™å‡ å¤©è¿‡å¾—å¥½å¿«ï¼Œäººæ€»ä¼šæœ‰å„ç§å„æ ·çš„äº‹æƒ…ç¼ ç€ä½ ã€‚æƒ³è¦åœ¨æœ‰é™çš„æ—¶é—´å»åšä¸€äº›çœŸæ­£æœ‰æ„ä¹‰çš„äº‹æƒ…ï¼Œå·¥ä½œè¿™ä¹ˆå¤šå¹´ï¼Œå®é™…å¯¹ç¤¾ä¼š
æœ‰è´¡çŒ®ï¼Œå¯¹äººç”Ÿæœ‰æ„ä¹‰ï¼Œå¯¹å¤§å®¶æœ‰ä»·å€¼çš„ä¸œè¥¿å¤ªå°‘äº†ã€‚äººæ´»ç€ä¸è¯¥åªä¸ºäº†é’±å¯¹å—ï¼Ÿä½•å†µè‡ªå·±ä¾æ—§å­‘ç„¶ä¸€èº«ã€‚é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼Œè¿™è¾ˆå­åšæˆäº†ä»€ä¹ˆäº‹æƒ…èƒ½è®©è‡ªå·±å¹´è€æ—¶
ä¸è‡³äºç¾æ„¤æ‡Šæ‚”ã€‚æˆ‘æƒ³ï¼Œç¤¾ä¼šæŠŠä½ ç»‘åœ¨è½¦è½®ä¸Šï¼Œä½†ä½ å§‹ç»ˆæœ‰é€‰æ‹©çš„ä½™åœ°ä¸æ˜¯å—ï¼Ÿä¹Ÿè®¸ä¸æ˜¯ä¸–ç•Œå¤ªå˜ˆæ‚ï¼Œåªæ˜¯è‡ªå·±ä¸å¤Ÿå®é™è‡´è¿œã€‚</p>
</blockquote>
<ul>
<li>4.gatewayå¼€å‘ä½“éªŒå¥½äº†</li>
</ul>
<blockquote>
<p>æ—©å¹´å°è¯•ä½¿ç”¨gatewayå¼€å‘çš„æ—¶å€™ï¼Œè‡ªå·±äº‘é‡Œé›¾é‡Œçš„ã€‚ä¸çŸ¥é“æ˜¯å› ä¸ºè‡ªå·±æŠ€æœ¯å˜å¼ºäº†è¿˜æ˜¯gatewayå®Œå–„äº†ã€‚ä¸è¿‡å§‹ç»ˆä¸å¤Ÿå¼€ç®±å³ç”¨å•Šï¼Œè¿‡å‡ å¤©ç ”ç©¶ä¸‹soulç½‘å…³(ShenYu)
çœ‹çœ‹èƒ½ä¸èƒ½è´¡çŒ®äº›ä»£ç ï¼Œä¸€èµ·åšä¸ªå¼€ç®±å³ç”¨çš„äº§å“å‡ºæ¥ã€‚æ„Ÿæ…¨è¿™å‡ å¹´é‡åˆ°çš„å¤§ç¥ï¼Œxxlè®¸é›ªé‡Œã€discoveryå†›å“¥ã€apolloå®‹é¡ºã€spring4allç¿Ÿæ°¸è¶…ã€dromara xiaoyuï¼Œ
æœ‰çš„æœ‰æ¯”è¾ƒæ·±å…¥çš„æ¥è§¦ï¼Œæœ‰çš„åªæ˜¯åœ¨çº¿ä¸‹è§è¿‡ï¼Œæœ‰çš„è®¨è®ºè¿‡issueï¼Œæœ‰çš„åªåœ¨ç¾¤é‡ŒèŠè¿‡å‡ å¥ï¼Œç”šè‡³æœ‰äº›ä¸æ„¿æ„æåŠçš„æ¸£äººéƒ½æ²¡æœ‰åˆ—å‡ºæ¥ï¼Œæ‰€æœ‰äººåšæˆä¸€ä¸ªæˆåŠŸçš„é¡¹ç›®ï¼Œ
å…¶ç¤¾åŒºå®£ä¼ ã€å½±å“åŠ›ã€ä½œå“äº§å“å®Œå–„ç¨‹åº¦ä¸ç”Ÿäº§éªŒè¯æœé›†bugé©±åŠ¨äº§å“è¿›æ­¥ï¼Œæ— ä¸€ä¸æ˜¯æŠŠç¤¾åŒºäº§å“è¿­ä»£åšå¾—æ¯”è¾ƒå¥½ã€‚ä¸€ä¸ªå¥½çš„äº§å“è¦å…·æœ‰å‰ç»æ€§ã€è¦è¶³å¤Ÿå®Œå–„ã€è¦bug
å°‘å¯éªŒè¯ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œè¦æœ‰å¼¥è¡¥ç©ºç™½çš„å®šä½ã€‚å¦‚æœå®šä½ä¸å…¶ä»–äº§å“é‡å ï¼Œä¸€å®šè¦æœ‰è¶³å¤Ÿç—›çš„ç‚¹è®©äººæƒ³å®Œæˆè¿ç§»ã€‚apacheç¤¾åŒºå·ç§°ç¤¾åŒºå¤§äºäº§å“ï¼Œæœ‰äººæ‰èƒ½æœ‰äº§å“ï¼Œ
ä¸€ä¸ªäººåšå¤šä¹…éƒ½ä¸å¯èƒ½å®Œæˆä¸€ä¸ªå®Œå–„çš„äº§å“ï¼Œå³ä¾¿å¯ä»¥ï¼Œé‚£ä»˜å‡ºçš„ç²¾åŠ›ä¸å¯èƒ½æ˜¯åœ¨æ»¡è¶³ç”Ÿæ´»å‰æä¸‹å®Œæˆçš„ã€‚è¦è¶³å¤Ÿvisionaryï¼Œè¦è¶³å¤Ÿresponsibleï¼Œæ›´å…³å¿ƒäº§å“ï¼Œ
æ›´æƒ³è¦è¡¨è¾¾ã€‚</p>
</blockquote>
<ul>
<li>5.springfox-oas å±…ç„¶ä¸æ”¯æŒ X-Forwarded-Prefix</li>
</ul>
<blockquote>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨æ—©å‰swagger2.0çš„æ—¶å€™å°±å·²ç»æ”¯æŒäº†ï¼Œåœ¨swagger3.0çš„webfluxç‰ˆæœ¬çœ‹ç€ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªmvcç‰ˆæœ¬ä¸æ”¯æŒï¼Œæœ‰ç‚¹ä»¤äººç–‘æƒ‘ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿåº”è¯¥
å»æä¸ªissueæ¥å‡çº§ä¸€ä¸‹è¿™ä¸ªfeatureã€‚</p>
</blockquote>
<blockquote>
<p>å»çœ‹äº†ä¸€ä¸‹ï¼Œç°åœ¨springfoxè²Œä¼¼æ˜¯ä¸ªå°åº¦äººåœ¨ç»´æŠ¤ï¼Œä½†æ˜¯PRå·²ç»å¾ˆä¹…æ²¡æœ‰äººåˆå¹¶äº†ï¼Œä¸çŸ¥é“è¿˜èƒ½ä¸èƒ½ä¹Ÿä¸çŸ¥é“å•¥æ—¶å€™æ‰ä¼šå†releaseäº†ï¼Œå¦‚æœè¿™è€å“¥è¢«æ–°å† ç¼ ä½äº†ï¼Œ
é‚£ä¹Ÿå¤ªè®©äººéš¾è¿‡äº†ã€‚</p>
</blockquote>
<hr>
<ul class=pager>
<li class=previous>
<a href=/2021/10/03/%E4%B8%83%E5%A4%A9%E6%9E%84%E5%BB%BAspringcloud%E9%9B%86%E7%BE%A4/ data-toggle=tooltip data-placement=top title=ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤>&larr;
Previous Post</a>
</li>
<li class=next>
<a href=/2021/10/05/%E4%B8%83%E5%A4%A9%E6%9E%84%E5%BB%BAspringcloud%E9%9B%86%E7%BE%A4/ data-toggle=tooltip data-placement=top title=ä¸ƒå¤©æ„å»ºSpringCloudé›†ç¾¤>Next
Post &rarr;</a>
</li>
</ul>
<div id=disqus-comment></div>
</div>
<div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container">
<div class=side-catalog>
<hr class="hidden-sm hidden-xs">
<h5>
<a class=catalog-toggle href=#>CATALOG</a>
</h5>
<ul class=catalog-body></ul>
</div>
</div>
<div class="col-lg-11 col-lg-offset-1
col-md-10 col-md-offset-1
sidebar-container">
<section>
<hr class="hidden-sm hidden-xs">
<h5><a href=/tags/>FEATURED TAGS</a></h5>
<div class=tags>
<a href=/tags/%E4%BC%A0%E5%A5%87 title=ä¼ å¥‡>
ä¼ å¥‡
</a>
<a href=/tags/%E5%B9%B2%E8%B4%A7 title=å¹²è´§>
å¹²è´§
</a>
<a href=/tags/%E6%84%9F%E6%82%9F title=æ„Ÿæ‚Ÿ>
æ„Ÿæ‚Ÿ
</a>
<a href=/tags/%E6%95%99%E7%A8%8B title=æ•™ç¨‹>
æ•™ç¨‹
</a>
<a href=/tags/%E9%97%B2%E8%B0%88 title=é—²è°ˆ>
é—²è°ˆ
</a>
</div>
</section>
<section>
<hr>
<h5>FRIENDS</h5>
<ul class=list-inline>
<li><a target=_blank href=https://yloopdaed.icu/>yloopdaedçš„åšå®¢</a></li>
</ul>
</section>
</div>
</div>
</div>
</article>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center">
<li>
<a href=mailto:yuebaix@outlook.com>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a target=_blank href=https://github.com/yuebaix>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="copyright text-muted">
Copyright &copy; æœˆç™½ Yuebaix Blog 2021
</p>
</div>
</div>
</div>
</footer>
<script>function loadAsync(f,b){var c=document,d='script',a=c.createElement(d),e=c.getElementsByTagName(d)[0];a.src=f,b&&a.addEventListener('load',function(a){b(null,a)},!1),e.parentNode.insertBefore(a,e)}</script>
<script>$('#tag_cloud').length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:'#bbbbee',end:'#0085a1'}},$('#tag_cloud a').tagcloud()})</script>
<script>loadAsync("https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.js",function(){var a=document.querySelector("nav");a&&FastClick.attach(a)})</script>
<script type=text/javascript>function generateCatalog(a){_containerSelector='div.post-container';var h=$(_containerSelector),c,d,e,f,g,b;return c=h.find('h1,h2,h3,h4,h5,h6'),$(a).html(''),c.each(function(){d=$(this).prop('tagName').toLowerCase(),g="#"+$(this).prop('id'),e=$(this).text(),b=$('<a href="'+g+'" rel="nofollow">'+e+'</a>'),f=$('<li class="'+d+'_nav"></li>').append(b),$(a).append(f)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(a){a.preventDefault(),$('.side-catalog').toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$('.catalog-body').onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script>
</body>
</html>